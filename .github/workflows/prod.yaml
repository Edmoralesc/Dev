name: PROD


on:
  workflow_run:
    workflows: ["STAGE"]  # Must match `name:` in stage.yaml
    types:
      - completed



env: 
  REGISTRY: emoralesc
  IMAGE_NAME: kubelabs_publicapi
  OPS_REPO: Edmoralesc/Ops
  OPS_BRANCH: main

  # emoralesc/kubelabs_publicapi

jobs:

  create-pull-request:
      if: ${{ github.event.workflow_run.conclusion == 'success' }}
      runs-on: ubuntu-latest
    
      # exporta las variables tipo output al resto de JOBS del pipeline dasdsad
      outputs:
        RELEASE_VERSION: ${{ steps.tagVersion.outputs.RELEASE_VERSION }}

      steps:
        - name: checkout-code
          uses: actions/checkout@v3
          with: 
            ref: stage
            
        - name: Create Pull Request to Main
          uses: peter-evans/create-pull-request@v7

          with:
            username: ${{ secrets.DOCKER_USERNAME}}
            password: ${{ secrets.DOCKER_PASSWORD}}
            
            base: main
            branch: stage
            title: "Promote stage to main"
            body: "Automatically created after successful stage workflow."
            draft: false


